<div class="row">

  <div class="col"><p class="h4 mb-4">Update system recipient </p></div>
  <div class="col-md-6">
      <button class="float-right back-button" (click)="back()"><i class="fas fa-angle-double-left"></i> Back </button>
    </div>   
</div>
<hr>
<mdb-card>
<!-- Default form contact -->
<form [formGroup]="updateForm" class="text-center border  p-5" (ngSubmit) = "onSubmit()">
<div class="row">
  <div class="col-6">
    <!-- Recipient -->
    <label for="recipient">Recipient</label>
    <!-- <select id=recipient class="browser-default custom-select form-control mb-4" formControlName="Recipient">
      <option *ngFor="let recipient of recipients; let i = index" [value]="recipient.id">
            {{recipient.name}}
      </option>
    </select> -->
    <div *ngIf="recipients?.length">
        <ng-select2 style="width:100%;" class=" custom-select-dropdown" formControlName="Recipient" [data]="recipients">
        </ng-select2>
      </div>
    <div *ngIf="updateForm.controls['Recipient'].invalid && (updateForm.controls['Recipient'].dirty || updateForm.controls['Recipient'].touched)" class="invalid-feedback">
        <div *ngIf="updateForm.controls['Recipient'].errors.required">
            Please Select a Recipient.
        </div>
    </div>
  </div>
</div>
<!--separator-->
<div class="row">
  <div class="col">
  </div>
</div>
  <!--Escalations form options-->
  <div class="row"  formArrayName="escalations">
      <div class="col-12"
      *ngFor="let escalation of escalationsArray.controls; let escalationIndex = index;"
      [formGroupName]="escalationIndex">
      <hr>
      <div class="row">
        <div class="col">
            <label>Escalation Level</label>
            <div *ngIf="escalationLevels?.length">
              <ng-select2 style="width:100%;" class=" custom-select-dropdown" formControlName="EscalationLevel" [data]="escalationLevels">
              </ng-select2>
            </div>
          <div *ngIf="escalation['controls']['EscalationLevel'].invalid && (escalation['controls']['EscalationLevel.dirty'] || escalation['controls']['EscalationLevel'].touched)" class="invalid-feedback">
              <div *ngIf="escalation['controls']['EscalationLevel'].errors.required">
                  Please Select an escalation level.
              </div>
          </div>
        </div>
        <div class="col">
            <label> Notification Type </label>
            <div *ngIf="notificationTypes?.length">
              <ng-select2 style="width:100%;" class=" custom-select-dropdown" formControlName="NotificationType"  [data]="notificationTypes">
              </ng-select2>
            </div>
          <div *ngIf="escalation['controls']['NotificationType'].invalid && (escalation['controls']['NotificationType'].dirty || escalation['controls']['NotificationType'].touched)" class="invalid-feedback">
              <div *ngIf="escalation['controls']['NotificationType'].errors.required">
                  Please Select a notification type.
              </div>
          </div>
        </div>
        <div class="col">
          <label> State </label>
          <div *ngIf="notificationTypes?.length">
            <ng-select2 style="width:100%;" class=" custom-select-dropdown" formControlName="State"  [data]="states">
            </ng-select2>
          </div>
        <div *ngIf="escalation['controls']['NotificationType'].invalid && (escalation['controls']['NotificationType'].dirty || escalation['controls']['NotificationType'].touched)" class="invalid-feedback">
            <div *ngIf="escalation['controls']['NotificationType'].errors.required">
                Please Select a notification type.
            </div>
        </div>
        <a [ngClass]="{'display-none': escalationIndex === 0}" id="remove"><img src="../../../../assets/icons/remove.svg" alt="" width="24" height="24" (click)="deleteEscalations(escalationIndex)"></a>
      </div>
      </div>
      </div>
  </div>
<!-- Send button -->
<button mdbBtn type="submit" size="sm" class="btn float-right btn-primary waves-light"  mdbWavesEffect
[disabled]="!updateForm.valid" (click)="updateRecipient()">Save</button>
<!--Add escalations button-->
<button [ngClass]="{disabled : escalationsArray.length >= escalationLevels.length}" mdbBtn type="submit" size="sm" class="btn float-right btn-primary waves-light"  mdbWavesEffect
 (click)="addEscalations()">Add escalation</button>

</form>
<!-- Default form contact -->

</mdb-card>

